<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sano Betting Tips</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
body{margin:0;font-family:Segoe UI,sans-serif;background:linear-gradient(135deg,#0f172a,#1e293b);color:#fff;}
header{position:fixed;top:0;width:100%;background:#111827;text-align:center;padding:18px 10px 10px;z-index:1000;}
header h1{margin:0 0 12px;font-size:22px;background:linear-gradient(90deg,#facc15,#f59e0b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.menu{display:flex;justify-content:space-around;}
.menu button{background:none;border:none;color:#94a3b8;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:13px;font-weight:600;cursor:pointer;}
.menu button i{font-size:18px;}
.menu button.active{color:#facc15;}
#predictions{padding:150px 15px 40px;}
.date-header{margin-top:25px;font-weight:700;color:#facc15;}
.card{background:rgba(255,255,255,0.05);padding:15px;margin-top:12px;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,0.4);}
.card-top{display:flex;justify-content:space-between;font-size:12px;color:#94a3b8;}
.teams{display:flex;justify-content:space-between;margin:10px 0;font-weight:600;}
.vs{color:#facc15;}
.bottom{display:flex;justify-content:space-between;align-items:center;}
.odds{color:#10b981;font-weight:700;}
.card.vip{filter:blur(4px);opacity:0.6;pointer-events:none;}
.loading{border:4px solid rgba(255,255,255,0.1);border-top:4px solid #facc15;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:60px auto;}
@keyframes spin{100%{transform:rotate(360deg);}}
.empty{text-align:center;padding:30px;color:#94a3b8;}

/* ===== Login Modal ===== */
#loginModal{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:2000;
}
#loginModal .modal-content{
  background:#111827;padding:20px;border-radius:12px;width:90%;max-width:350px;color:#fff;display:flex;flex-direction:column;gap:10px;
}
#loginModal input{padding:10px;border-radius:6px;border:none;outline:none;font-size:14px;}
#loginModal button{padding:10px;border:none;border-radius:6px;background:#f59e0b;color:#111827;font-weight:600;cursor:pointer;}
#loginModal .toggle-link{color:#facc15;text-decoration:underline;cursor:pointer;text-align:center;font-size:13px;}
#loginModal .message{text-align:center;font-size:14px;min-height:18px;}
</style>
</head>
<body>

<header>
  <h1>Sano Betting Tips</h1>
  <div class="menu">
    <button class="active" data-category="free"><i class="bi bi-circle-fill"></i> Free</button>
    <button data-category="safe"><i class="bi bi-shield-fill"></i> Safe</button>
    <button data-category="fixed"><i class="bi bi-star-fill"></i> Fixed</button>
  </div>
</header>

<main id="predictions"><div class="loading"></div></main>

<!-- ===== Login Modal ===== -->
<div id="loginModal" style="display:none;">
  <div class="modal-content">
    <h2 id="modalTitle">Login</h2>
    <div class="message" id="modalMessage"></div>
    <input type="email" id="modalEmail" placeholder="Email">
    <input type="password" id="modalPassword" placeholder="Password">
    <button id="modalButton">Login</button>
    <div class="toggle-link" id="toggleLogin">Don't have an account? Register</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// ðŸ”¥ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyC0BSUvubGtHxeHZ_pnh776bzoGKGxXNbU",
  authDomain: "voltflow-35a0b.firebaseapp.com",
  projectId: "voltflow-35a0b",
  storageBucket: "voltflow-35a0b.firebasestorage.app",
  messagingSenderId: "241701625823",
  appId: "1:241701625823:web:d4d7d9362e0207e5a32e6a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const container = document.getElementById("predictions");
const buttons = document.querySelectorAll(".menu button");

// ===== Login Modal Elements =====
const loginModal = document.getElementById("loginModal");
const modalTitle = document.getElementById("modalTitle");
const modalMessage = document.getElementById("modalMessage");
const modalEmail = document.getElementById("modalEmail");
const modalPassword = document.getElementById("modalPassword");
const modalButton = document.getElementById("modalButton");
const toggleLogin = document.getElementById("toggleLogin");

let isLogin = true;
let currentCategory="free";
let currentUserPlan="free";

// ===== Check local user =====
const localUser = JSON.parse(localStorage.getItem("user"));
if(!localUser){
  loginModal.style.display="flex";
} else {
  currentUserPlan = localUser.subscription || "free";
  render(currentCategory);
}

// ===== Toggle login/register =====
toggleLogin.addEventListener("click", ()=>{
  isLogin = !isLogin;
  modalTitle.textContent = isLogin ? "Login" : "Register";
  modalButton.textContent = isLogin ? "Login" : "Register";
  toggleLogin.textContent = isLogin ? "Don't have an account? Register" : "Already have account? Login";
  modalMessage.textContent="";
});

// ===== Login/Register Handler =====
modalButton.addEventListener("click", async()=>{
  const email = modalEmail.value.trim();
  const password = modalPassword.value.trim();
  if(!email || !password){ modalMessage.textContent="Enter email & password"; return; }
  modalMessage.textContent="Loading...";
  try{
    let userCredential;
    if(isLogin){
      userCredential = await signInWithEmailAndPassword(auth,email,password);
    } else {
      userCredential = await createUserWithEmailAndPassword(auth,email,password);
      // Add new user to Firestore
      await addDoc(collection(db,"users"),{
        email:userCredential.user.email,
        subscription:"free",
        createdAt:new Date().toISOString()
      });
    }

    // Get subscription from Firestore
    const q = query(collection(db,"users"),where("email","==",userCredential.user.email));
    const snap = await getDocs(q);
    let subscription="free";
    if(!snap.empty){ snap.forEach(d=>subscription=d.data().subscription||"free"); }
    
    localStorage.setItem("user",JSON.stringify({email:userCredential.user.email,subscription}));
    currentUserPlan = subscription;

    loginModal.style.display="none";
    render(currentCategory);
  } catch(err){
    console.error(err);
    modalMessage.textContent=err.message;
  }
});

// ===== Fetch Matches =====
async function getMatches(){ 
  const snap = await getDocs(collection(db,"matches"));
  const data=[]; snap.forEach(d=>data.push(d.data())); return data;
}

// ===== Determine if should blur =====
function shouldBlur(matchCategory){
  if(matchCategory==="free") return false;
  if(matchCategory==="safe") return !(currentUserPlan==="safe"||currentUserPlan==="fixed");
  if(matchCategory==="fixed") return !(currentUserPlan==="fixed");
  return true;
}

// ===== Render =====
async function render(category){
  currentCategory = category;
  container.innerHTML='<div class="loading"></div>';
  const matches = await getMatches();
  const filtered = matches.filter(m => (m.category||"").toLowerCase()===category.toLowerCase());
  filtered.sort((a,b)=> new Date(b.date)-new Date(a.date));
  container.innerHTML="";
  if(!filtered.length){ container.innerHTML='<div class="empty">No matches available</div>'; return; }

  let lastDate=null;
  filtered.forEach(m=>{
    const matchDate=new Date(m.date);
    const dateString = matchDate.getDate().toString().padStart(2,'0')+" "+
                       matchDate.toLocaleString('default',{month:'short'})+" "+
                       matchDate.getFullYear();
    if(dateString!==lastDate){
      const dateDiv=document.createElement("div");
      dateDiv.className="date-header"; dateDiv.textContent=dateString; container.appendChild(dateDiv);
      lastDate=dateString;
    }
    const hideVIP = shouldBlur(m.category);
    const card = document.createElement("div");
    card.className="card"+(hideVIP?" vip":"");
    card.innerHTML=`
      <div class="card-top">
        <span>${m.league||"-"}</span>
        <span>${matchDate.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</span>
      </div>
      <div class="teams">
        <span>${m.homeTeam||"Home"}</span>
        <span class="vs">VS</span>
        <span>${m.awayTeam||"Away"}</span>
      </div>
      <div class="bottom">
        <div><small>Prediction</small><div>${hideVIP?"ðŸ”’ Upgrade Plan":(m.prediction||"-")}</div></div>
        <div class="odds">${hideVIP?"00":Number(m.odd||m.odds||0).toFixed(2)}</div>
      </div>
    `;
    container.appendChild(card);
  });
}

// ===== Menu buttons =====
buttons.forEach(btn=>{
  btn.addEventListener("click",()=>{
    buttons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    render(btn.dataset.category);
  });
});

</script>
</body>
</html>
